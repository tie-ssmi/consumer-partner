<!DOCTYPE html>
<html lang="th">
<head>
    <script>
    // Security Check
    if (localStorage.getItem('admin_logged_in') !== 'true') {
        window.location.href = '../admin_login/index.html';
    }
    </script>
    <meta charset="UTF-8">
    <title>System Users Management</title>
    <link rel="stylesheet" href="js/admin_style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        /* Table Styles */
        .table-wrapper { overflow-x: auto; white-space: nowrap; padding-bottom: 20px; } 
        th, td { padding: 12px 10px; font-size: 11px; vertical-align: middle; border-bottom: 1px solid #f3f4f6; }
        th { background-color: #f9fafb; font-weight: 600; color: #4b5563; }
        tr:hover { background-color: #f8fafc; transition: 0.2s; }
        
        /* Button Styles */
        .btn-action { padding: 4px 8px; border-radius: 4px; font-size: 10px; color: white; margin: 0 2px; transition: 0.2s; }
        .btn-blue { background-color: #00c0ef; } .btn-blue:hover { background-color: #00acd6; }
        .btn-green { background-color: #00a65a; } .btn-green:hover { background-color: #008d4c; }
        .btn-orange { background-color: #f39c12; } .btn-orange:hover { background-color: #e08e0b; }
        .btn-red { background-color: #dd4b39; } .btn-red:hover { background-color: #d73925; }

        /* ‚úÖ CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sidebar ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (System Menu Style) */
        .sys-menu-header {
            color: #4b646f;
            background: #1a2226;
            padding: 10px 25px 10px 15px;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
        }
        .sys-menu-item {
            display: block;
            padding: 12px 15px;
            color: #b8c7ce;
            border-bottom: 1px solid #222d32;
            transition: all 0.3s;
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
        }
        .sys-menu-item:hover {
            background-color: #1e282c;
            color: #fff;
        }
        .sys-menu-item.active {
            background-color: #1e282c;
            color: #fff;
            border-left: 3px solid #00a65a; /* ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
        }
        .sys-menu-item i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <script src="js/admin_ui.js"></script>
    <script src="js/firebase_setup.js"></script> 

    <script>
        // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Render UI (‡πÉ‡∏™‡πà 'system' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Header Active)
        renderAdminUI('system', 'users'); 

        // ‚úÖ 2. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö Sidebar ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á System
        setTimeout(() => {
            const sidebarContainer = document.querySelector('aside') || document.getElementById('sidebar-menu'); 
            
            if (sidebarContainer) {
                sidebarContainer.innerHTML = `
                    <div class="h-full bg-[#222d32] overflow-y-auto custom-scroll pt-2">
                        
                        <div class="sys-menu-header">‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</div>
                        
                        <a href="admin_system.html" class="sys-menu-item">
                            <i class="fa-solid fa-gears"></i> ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏£‡∏∞‡∏ö‡∏ö
                        </a>
                        <a href="#" class="sys-menu-item">
                            <i class="fa-solid fa-list"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏∞‡∏ö‡∏ö
                        </a>
                        <a href="admin_system.html" class="sys-menu-item">
                            <i class="fa-solid fa-credit-card"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </a>
                        <a href="#" class="sys-menu-item">
                            <i class="fa-solid fa-file-lines"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </a>

                        <div class="sys-menu-header">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</div>
                        
                        <a href="#" class="sys-menu-item">
                            <i class="fa-solid fa-shield-halved"></i> ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
                        </a>
                        
                        <a href="#" class="sys-menu-item active">
                            <i class="fa-solid fa-users-gear"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö
                        </a>
                    </div>
                `;
            }
        }, 100);

        // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á (Content)
        document.getElementById('main-content').innerHTML = `
            <div class="bg-white p-5 shadow-sm border-b flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö (System Admins)</h2>
                <div class="flex gap-2">
                    <button onclick="openModal('add')" class="bg-[#00a65a] text-white px-3 py-1.5 rounded text-xs hover:bg-[#008d4c] font-bold shadow transition">
                        <i class="fa-solid fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    </button>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-4 mx-4">
                <h3 class="text-xs font-bold text-gray-500 mb-3 uppercase tracking-wide flex items-center gap-2">
                    <i class="fa-solid fa-magnifying-glass text-blue-500"></i> ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
                </h3>
                <div class="flex flex-wrap gap-3 items-end">
                    <div class="w-full sm:w-auto">
                        <label class="block text-[10px] text-gray-400 mb-1">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
                        <input type="text" id="filter-user" onkeyup="fetchAdmins()" class="border border-gray-300 rounded px-3 py-1.5 text-xs w-full focus:outline-none focus:border-blue-400" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...">
                    </div>
                    <div class="w-full sm:w-auto">
                        <label class="block text-[10px] text-gray-400 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (Name)</label>
                        <input type="text" id="filter-name" onkeyup="fetchAdmins()" class="border border-gray-300 rounded px-3 py-1.5 text-xs w-full focus:outline-none focus:border-blue-400" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á...">
                    </div>
                    <div class="w-full sm:w-auto">
                        <label class="block text-[10px] text-gray-400 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="filter-status" onchange="fetchAdmins()" class="border border-gray-300 rounded px-3 py-1.5 text-xs w-full bg-white focus:outline-none focus:border-blue-400 cursor-pointer">
                            <option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                            <option value="active">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                            <option value="banned">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                        </select>
                    </div>
                    <button onclick="fetchAdmins()" class="bg-gray-100 border border-gray-300 text-gray-600 px-4 py-1.5 rounded text-xs hover:bg-gray-200 font-bold transition shadow-sm">
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 mx-4 overflow-hidden">
                <div class="table-wrapper custom-scroll">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="w-10 text-center"><input type="checkbox"></th>
                                <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (Name)</th>
                                <th>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role)</th>
                                <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                                <th class="text-center w-48">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="admin-list-body">
                            <tr><td colspan="7" class="text-center p-8 text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="modal-admin" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm">
                <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 transform scale-100 transition-transform">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h3 id="modal-title" class="font-bold text-gray-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    
                    <div class="space-y-3 text-sm">
                        <input type="hidden" id="admin-doc-id">
                        
                        <div>
                            <label class="block text-gray-600 mb-1 text-xs font-bold">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username) <span class="text-red-500">*</span></label>
                            <input type="text" id="inp-username" class="w-full border border-gray-300 rounded px-3 py-2 focus:border-blue-500 outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 mb-1 text-xs font-bold">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (Name)</label>
                            <input type="text" id="inp-name" class="w-full border border-gray-300 rounded px-3 py-2 focus:border-blue-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô: Super Admin">
                        </div>

                        <div>
                            <label class="block text-gray-600 mb-1 text-xs font-bold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)</label>
                            <input type="text" id="inp-password" class="w-full border border-gray-300 rounded px-3 py-2 focus:border-blue-500 outline-none" placeholder="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                        </div>

                        <div>
                            <label class="block text-gray-600 mb-1 text-xs font-bold">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role)</label>
                            <select id="inp-role" class="w-full border border-gray-300 rounded px-3 py-2 bg-white focus:border-blue-500 outline-none">
                                <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (Admin)</option>
                                <option value="owner">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö (Owner)</option>
                                <option value="support">‡∏ù‡πà‡∏≤‡∏¢‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï (Support)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-gray-600 mb-1 text-xs font-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                            <select id="inp-status" class="w-full border border-gray-300 rounded px-3 py-2 bg-white focus:border-blue-500 outline-none">
                                <option value="active">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Active)</option>
                                <option value="banned">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Inactive)</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
                        <button onclick="saveAdmin()" class="bg-[#00a65a] hover:bg-[#008d4c] text-white px-4 py-2 rounded text-xs font-bold shadow">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button onclick="closeModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded text-xs font-bold shadow">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>
        `;

        // --- Logic Scripts ---
        
        let allAdmins = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á

        // 1. Fetch Data
        async function fetchAdmins() {
            if (!window.db) return setTimeout(fetchAdmins, 1000);

            const tbody = document.getElementById('admin-list-body');
            
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ onSnapshot ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Realtime
            db.collection("admins").orderBy("created_at", "desc").onSnapshot((snap) => {
                allAdmins = [];
                snap.forEach(doc => {
                    allAdmins.push({ id: doc.id, ...doc.data() });
                });
                renderTable(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Realtime ‡πÑ‡∏î‡πâ)
        function renderTable() {
            const tbody = document.getElementById('admin-list-body');
            const filterUser = document.getElementById('filter-user').value.toLowerCase();
            const filterName = document.getElementById('filter-name').value.toLowerCase();
            const filterStatus = document.getElementById('filter-status').value;

            let html = '';
            let hasData = false;

            allAdmins.forEach(d => {
                // Default Values
                const status = d.status || 'active'; 
                const name = d.name || '-';
                const role = d.role || 'admin';
                const username = d.username || '';

                // üîç Filter Logic
                if (filterUser && !username.toLowerCase().includes(filterUser)) return;
                if (filterName && !name.toLowerCase().includes(filterName)) return;
                if (filterStatus && status !== filterStatus) return;

                hasData = true;

                const statusBadge = status === 'active' 
                    ? '<span class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-[10px] font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>' 
                    : '<span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-[10px] font-bold">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>';

                const dateStr = d.created_at ? new Date(d.created_at).toLocaleString('th-TH') : '-';
                
                // Prepare Data for Edit
                const dataStr = JSON.stringify({
                    id: d.id, 
                    username: username,
                    name: name,
                    role: role,
                    status: status,
                    password: d.password 
                }).replace(/"/g, '&quot;');

                html += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="text-center"><input type="checkbox"></td>
                        <td class="font-bold text-gray-700">${username}</td>
                        <td class="text-gray-600">${name}</td>
                        <td><span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-[10px] font-bold border border-blue-100 uppercase">${role}</span></td>
                        <td class="text-center">${statusBadge}</td>
                        <td class="text-gray-500 text-[10px]">${dateStr}</td>
                        <td class="text-center">
                            <div class="flex justify-center gap-1">
                                <button onclick="openModal('edit', ${dataStr})" class="btn-action btn-green">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button onclick="deleteAdmin('${d.id}')" class="btn-action btn-red">‡∏•‡∏ö</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            if (!hasData) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center p-8 text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</td></tr>';
            } else {
                tbody.innerHTML = html;
            }
        }

        // 2. Modal Functions
        window.openModal = (mode, data = null) => {
            const modal = document.getElementById('modal-admin');
            const title = document.getElementById('modal-title');
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤
            document.getElementById('admin-doc-id').value = '';
            document.getElementById('inp-username').value = '';
            document.getElementById('inp-name').value = ''; 
            document.getElementById('inp-password').value = '';
            document.getElementById('inp-role').value = 'admin'; 
            document.getElementById('inp-status').value = 'active';

            if (mode === 'add') {
                title.innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö';
                document.getElementById('inp-username').disabled = false;
            } else {
                title.innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö';
                document.getElementById('admin-doc-id').value = data.id;
                document.getElementById('inp-username').value = data.username;
                document.getElementById('inp-username').disabled = true; 
                
                document.getElementById('inp-name').value = data.name;
                document.getElementById('inp-password').value = data.password; 
                document.getElementById('inp-role').value = data.role;
                document.getElementById('inp-status').value = data.status;
            }
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        window.closeModal = () => {
            const modal = document.getElementById('modal-admin');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // 3. Save Data
        window.saveAdmin = async () => {
            const docId = document.getElementById('admin-doc-id').value;
            const username = document.getElementById('inp-username').value.trim();
            const name = document.getElementById('inp-name').value.trim(); 
            const password = document.getElementById('inp-password').value.trim();
            const role = document.getElementById('inp-role').value; 
            const status = document.getElementById('inp-status').value;

            if(!username) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username");
            if(!password) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");

            const dataObj = { 
                username: username,
                name: name,
                password: password,
                role: role,
                status: status
            };

            try {
                if (docId) {
                    await db.collection("admins").doc(docId).update(dataObj);
                } else {
                    const check = await db.collection("admins").where("username", "==", username).get();
                    if(!check.empty) return alert("Username ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß");

                    dataObj.created_at = new Date().toISOString();
                    await db.collection("admins").add(dataObj);
                }
                closeModal();
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            } catch(e) { alert("Error: " + e.message); }
        }

        // 4. Helper Actions
        window.deleteAdmin = async (docId) => {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ?")) {
                await db.collection("admins").doc(docId).delete();
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        fetchAdmins();

    </script>
</body>
</html>